#!/usr/bin/env node
var d=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Ce=d(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.__setModuleDefault=v.__createBinding=void 0;v.__classPrivateFieldSet=Or;v.__classPrivateFieldGet=Ar;v.__importStar=vr;v.__exportStar=Ir;function Or(e,t,r,n,o){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?o.call(e,r):o?o.value=r:t.set(e,r),r}function Ar(e,t,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(e):n?n.value:t.get(e)}var ke=Object.create?function(e,t,r,n){n===void 0&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]};v.__createBinding=ke;var xt=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};v.__setModuleDefault=xt;var Ue=function(e){return Ue=Object.getOwnPropertyNames||function(t){var r=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[r.length]=n);return r},Ue(e)};function vr(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r=Ue(e),n=0;n<r.length;n++)r[n]!=="default"&&ke(t,e,r[n]);return xt(t,e),t}function Ir(e,t){for(var r in e)r!=="default"&&!Object.prototype.hasOwnProperty.call(t,r)&&ke(t,e,r)}});var Mt=d(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.uuid4=void 0;var Tr=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return B.uuid4=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^r()&15>>+n/4).toString(16))};B.uuid4=Tr});var Le=d(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.castToError=void 0;H.isAbortError=$r;function $r(e){return typeof e=="object"&&e!==null&&("name"in e&&e.name==="AbortError"||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}var Fr=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null){try{if(Object.prototype.toString.call(e)==="[object Error]"){let t=new Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return new Error(JSON.stringify(e))}catch{}}return new Error(e)};H.castToError=Fr});var K=d(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.InternalServerError=p.RateLimitError=p.UnprocessableEntityError=p.ConflictError=p.NotFoundError=p.PermissionDeniedError=p.AuthenticationError=p.BadRequestError=p.APIConnectionTimeoutError=p.APIConnectionError=p.APIUserAbortError=p.APIError=p.SupermemoryError=void 0;var qr=Le(),se=class extends Error{};p.SupermemoryError=se;var P=class e extends se{constructor(t,r,n,o){super(`${e.makeMessage(t,r,n)}`),this.status=t,this.headers=o,this.error=r}static makeMessage(t,r,n){let o=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return t&&o?`${t} ${o}`:t?`${t} status code (no body)`:o||"(no status code or body)"}static generate(t,r,n,o){if(!t||!o)return new X({message:n,cause:(0,qr.castToError)(r)});let s=r;return t===400?new ie(t,s,n,o):t===401?new ae(t,s,n,o):t===403?new ce(t,s,n,o):t===404?new ue(t,s,n,o):t===409?new le(t,s,n,o):t===422?new de(t,s,n,o):t===429?new pe(t,s,n,o):t>=500?new fe(t,s,n,o):new e(t,s,n,o)}};p.APIError=P;var De=class extends P{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}};p.APIUserAbortError=De;var X=class extends P{constructor({message:t,cause:r}){super(void 0,void 0,t||"Connection error.",void 0),r&&(this.cause=r)}};p.APIConnectionError=X;var Ne=class extends X{constructor({message:t}={}){super({message:t??"Request timed out."})}};p.APIConnectionTimeoutError=Ne;var ie=class extends P{};p.BadRequestError=ie;var ae=class extends P{};p.AuthenticationError=ae;var ce=class extends P{};p.PermissionDeniedError=ce;var ue=class extends P{};p.NotFoundError=ue;var le=class extends P{};p.ConflictError=le;var de=class extends P{};p.UnprocessableEntityError=de;var pe=class extends P{};p.RateLimitError=pe;var fe=class extends P{};p.InternalServerError=fe});var Y=d(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.safeJSON=l.maybeCoerceBoolean=l.maybeCoerceFloat=l.maybeCoerceInteger=l.coerceBoolean=l.coerceFloat=l.coerceInteger=l.validatePositiveInteger=l.ensurePresent=l.isReadonlyArray=l.isArray=l.isAbsoluteURL=void 0;l.maybeObj=Ur;l.isEmptyObj=kr;l.hasOwn=Cr;l.isObj=Lr;var V=K(),xr=/^[a-z][a-z0-9+.-]*:/i,Mr=e=>xr.test(e);l.isAbsoluteURL=Mr;var jr=e=>(l.isArray=Array.isArray,(0,l.isArray)(e));l.isArray=jr;l.isReadonlyArray=l.isArray;function Ur(e){return typeof e!="object"?{}:e??{}}function kr(e){if(!e)return!0;for(let t in e)return!1;return!0}function Cr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Lr(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}var Dr=e=>{if(e==null)throw new V.SupermemoryError(`Expected a value to be given but received ${e} instead.`);return e};l.ensurePresent=Dr;var Nr=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new V.SupermemoryError(`${e} must be an integer`);if(t<0)throw new V.SupermemoryError(`${e} must be a positive integer`);return t};l.validatePositiveInteger=Nr;var Br=e=>{if(typeof e=="number")return Math.round(e);if(typeof e=="string")return parseInt(e,10);throw new V.SupermemoryError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};l.coerceInteger=Br;var Hr=e=>{if(typeof e=="number")return e;if(typeof e=="string")return parseFloat(e);throw new V.SupermemoryError(`Could not coerce ${e} (type: ${typeof e}) into a number`)};l.coerceFloat=Hr;var Xr=e=>typeof e=="boolean"?e:typeof e=="string"?e==="true":!!e;l.coerceBoolean=Xr;var Kr=e=>{if(e!=null)return(0,l.coerceInteger)(e)};l.maybeCoerceInteger=Kr;var Vr=e=>{if(e!=null)return(0,l.coerceFloat)(e)};l.maybeCoerceFloat=Vr;var Yr=e=>{if(e!=null)return(0,l.coerceBoolean)(e)};l.maybeCoerceBoolean=Yr;var Gr=e=>{try{return JSON.parse(e)}catch{return}};l.safeJSON=Gr});var jt=d(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});me.sleep=void 0;var Jr=e=>new Promise(t=>setTimeout(t,e));me.sleep=Jr});var Be=d(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.VERSION=void 0;he.VERSION="4.0.0"});var Lt=d(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.getPlatformHeaders=U.isRunningInBrowser=void 0;var G=Be(),Wr=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";U.isRunningInBrowser=Wr;function zr(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Qr=()=>{let e=zr();if(e==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":G.VERSION,"X-Stainless-OS":kt(Deno.build.os),"X-Stainless-Arch":Ut(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":G.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(e==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":G.VERSION,"X-Stainless-OS":kt(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Ut(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=Zr();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":G.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":G.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Zr(){if(typeof navigator>"u"||!navigator)return null;let e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:t,pattern:r}of e){let n=r.exec(navigator.userAgent);if(n){let o=n[1]||0,s=n[2]||0,i=n[3]||0;return{browser:t,version:`${o}.${s}.${i}`}}}return null}var Ut=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",kt=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown"),Ct,en=()=>Ct??(Ct=Qr());U.getPlatformHeaders=en});var He=d(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.getDefaultFetch=tn;x.makeReadableStream=Dt;x.ReadableStreamFrom=rn;x.ReadableStreamToAsyncIterable=nn;x.CancelReadableStream=on;function tn(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Supermemory({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Dt(...e){let t=globalThis.ReadableStream;if(typeof t>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function rn(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return Dt({start(){},async pull(r){let{done:n,value:o}=await t.next();n?r.close():r.enqueue(o)},async cancel(){await t.return?.()}})}function nn(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let r=await t.read();return r?.done&&t.releaseLock(),r}catch(r){throw t.releaseLock(),r}},async return(){let r=t.cancel();return t.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function on(e){if(e===null||typeof e!="object")return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}});var Nt=d(ye=>{"use strict";Object.defineProperty(ye,"__esModule",{value:!0});ye.FallbackEncoder=void 0;var sn=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)});ye.FallbackEncoder=sn});var J=d(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.createForm=_.multipartFormRequestOptions=_.maybeMultipartFormRequestOptions=_.isAsyncIterable=_.checkFileSupport=void 0;_.makeFile=Xe;_.getName=ge;var an=He(),cn=()=>{if(typeof File>"u"){let{process:e}=globalThis,t=typeof e?.versions?.node=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};_.checkFileSupport=cn;function Xe(e,t,r){return(0,_.checkFileSupport)(),new File(e,t??"unknown_file",r)}function ge(e){return(typeof e=="object"&&e!==null&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}var un=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function";_.isAsyncIterable=un;var ln=async(e,t)=>Ke(e.body)?{...e,body:await(0,_.createForm)(e.body,t)}:e;_.maybeMultipartFormRequestOptions=ln;var dn=async(e,t)=>({...e,body:await(0,_.createForm)(e.body,t)});_.multipartFormRequestOptions=dn;var Bt=new WeakMap;function pn(e){let t=typeof e=="function"?e:e.fetch,r=Bt.get(t);if(r)return r;let n=(async()=>{try{let o="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;return s.toString()!==await new o(s).text()}catch{return!0}})();return Bt.set(t,n),n}var fn=async(e,t)=>{if(!await pn(t))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([n,o])=>Ve(r,n,o))),r};_.createForm=fn;var Ht=e=>e instanceof Blob&&"name"in e,mn=e=>typeof e=="object"&&e!==null&&(e instanceof Response||(0,_.isAsyncIterable)(e)||Ht(e)),Ke=e=>{if(mn(e))return!0;if(Array.isArray(e))return e.some(Ke);if(e&&typeof e=="object"){for(let t in e)if(Ke(e[t]))return!0}return!1},Ve=async(e,t,r)=>{if(r!==void 0){if(r==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")e.append(t,String(r));else if(r instanceof Response)e.append(t,Xe([await r.blob()],ge(r)));else if((0,_.isAsyncIterable)(r))e.append(t,Xe([await new Response((0,an.ReadableStreamFrom)(r)).blob()],ge(r)));else if(Ht(r))e.append(t,r,ge(r));else if(Array.isArray(r))await Promise.all(r.map(n=>Ve(e,t+"[]",n)));else if(typeof r=="object")await Promise.all(Object.entries(r).map(([n,o])=>Ve(e,`${t}[${n}]`,o)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}}});var Kt=d(Ge=>{"use strict";Object.defineProperty(Ge,"__esModule",{value:!0});Ge.toFile=bn;var W=J(),hn=J(),Xt=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",yn=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&Xt(e),gn=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function";async function bn(e,t,r){if((0,hn.checkFileSupport)(),e=await e,yn(e))return e instanceof File?e:(0,W.makeFile)([await e.arrayBuffer()],e.name);if(gn(e)){let o=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),(0,W.makeFile)(await Ye(o),t,r)}let n=await Ye(e);if(t||(t=(0,W.getName)(e)),!r?.type){let o=n.find(s=>typeof s=="object"&&"type"in s&&s.type);typeof o=="string"&&(r={...r,type:o})}return(0,W.makeFile)(n,t,r)}async function Ye(e){let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Xt(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if((0,W.isAsyncIterable)(e))for await(let r of e)t.push(...await Ye(r));else{let r=e?.constructor?.name;throw new Error(`Unexpected data type: ${typeof e}${r?`; constructor: ${r}`:""}${_n(e)}`)}return t}function _n(e){return typeof e!="object"||e===null?"":`; props: [${Object.getOwnPropertyNames(e).map(r=>`"${r}"`).join(", ")}]`}});var Je=d(be=>{"use strict";Object.defineProperty(be,"__esModule",{value:!0});be.toFile=void 0;var Sn=Kt();Object.defineProperty(be,"toFile",{enumerable:!0,get:function(){return Sn.toFile}})});var k=d(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});_e.APIResource=void 0;var We=class{constructor(t){this._client=t}};_e.APIResource=We});var z=d(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.isEmptyHeaders=C.buildHeaders=void 0;var Vt=Y(),Yt=Symbol("brand.privateNullableHeaders");function*Gt(e){if(!e)return;if(Yt in e){let{values:n,nulls:o}=e;yield*n.entries();for(let s of o)yield[s,null];return}let t=!1,r;e instanceof Headers?r=e.entries():(0,Vt.isReadonlyArray)(e)?r=e:(t=!0,r=Object.entries(e??{}));for(let n of r){let o=n[0];if(typeof o!="string")throw new TypeError("expected header name to be a string");let s=(0,Vt.isReadonlyArray)(n[1])?n[1]:[n[1]],i=!1;for(let a of s)a!==void 0&&(t&&!i&&(i=!0,yield[o,null]),yield[o,a])}}var wn=e=>{let t=new Headers,r=new Set;for(let n of e){let o=new Set;for(let[s,i]of Gt(n)){let a=s.toLowerCase();o.has(a)||(t.delete(s),o.add(a)),i===null?(t.delete(s),r.add(a)):(t.append(s,i),r.delete(a))}}return{[Yt]:!0,values:t,nulls:r}};C.buildHeaders=wn;var En=e=>{for(let t of Gt(e))return!1;return!0};C.isEmptyHeaders=En});var Se=d(F=>{"use strict";Object.defineProperty(F,"__esModule",{value:!0});F.path=F.createPathTagFunction=void 0;F.encodeURIPath=ze;var Pn=K();function ze(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var Jt=Object.freeze(Object.create(null)),Rn=(e=ze)=>function(r,...n){if(r.length===1)return r[0];let o=!1,s=[],i=r.reduce((y,g,w)=>{/[?#]/.test(g)&&(o=!0);let c=n[w],E=(o?encodeURIComponent:e)(""+c);return w!==n.length&&(c==null||typeof c=="object"&&c.toString===Object.getPrototypeOf(Object.getPrototypeOf(c.hasOwnProperty??Jt)??Jt)?.toString)&&(E=c+"",s.push({start:y.length+g.length,length:E.length,error:`Value of type ${Object.prototype.toString.call(c).slice(8,-1)} is not a valid path parameter`})),y+g+(w===n.length?"":E)},""),a=i.split(/[?#]/,1)[0],h=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,m;for(;(m=h.exec(a))!==null;)s.push({start:m.index,length:m[0].length,error:`Value "${m[0]}" can't be safely passed as a path parameter`});if(s.sort((y,g)=>y.start-g.start),s.length>0){let y=0,g=s.reduce((w,c)=>{let E=" ".repeat(c.start-y),D="^".repeat(c.length);return y=c.start+c.length,w+E+D},"");throw new Pn.SupermemoryError(`Path parameters result in path with invalid segments:
${s.map(w=>w.error).join(`
`)}
${i}
${g}`)}return i};F.createPathTagFunction=Rn;F.path=(0,F.createPathTagFunction)(ze)});var Ze=d(we=>{"use strict";Object.defineProperty(we,"__esModule",{value:!0});we.Connections=void 0;var On=k(),An=z(),I=Se(),Qe=class extends On.APIResource{create(t,r={},n){return this._client.post((0,I.path)`/v3/connections/${t}`,{body:r,...n})}list(t={},r){return this._client.post("/v3/connections/list",{body:t,...r})}configure(t,r,n){return this._client.post((0,I.path)`/v3/connections/${t}/configure`,{body:r,...n})}deleteByID(t,r){return this._client.delete((0,I.path)`/v3/connections/${t}`,r)}deleteByProvider(t,r,n){return this._client.delete((0,I.path)`/v3/connections/${t}`,{body:r,...n})}getByID(t,r){return this._client.get((0,I.path)`/v3/connections/${t}`,r)}getByTag(t,r,n){return this._client.post((0,I.path)`/v3/connections/${t}/connection`,{body:r,...n})}import(t,r={},n){return this._client.post((0,I.path)`/v3/connections/${t}/import`,{body:r,...n,headers:(0,An.buildHeaders)([{Accept:"text/plain"},n?.headers])})}listDocuments(t,r={},n){return this._client.post((0,I.path)`/v3/connections/${t}/documents`,{body:r,...n})}resources(t,r={},n){return this._client.get((0,I.path)`/v3/connections/${t}/resources`,{query:r,...n})}};we.Connections=Qe});var rt=d(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.Documents=void 0;var vn=k(),In=z(),Tn=J(),et=Se(),tt=class extends vn.APIResource{update(t,r={},n){return this._client.patch((0,et.path)`/v3/documents/${t}`,{body:r,...n})}list(t={},r){return this._client.post("/v3/documents/list",{body:t,...r})}delete(t,r){return this._client.delete((0,et.path)`/v3/documents/${t}`,{...r,headers:(0,In.buildHeaders)([{Accept:"*/*"},r?.headers])})}add(t,r){return this._client.post("/v3/documents",{body:t,...r})}batchAdd(t,r){return this._client.post("/v3/documents/batch",{body:t,...r})}deleteBulk(t={},r){return this._client.delete("/v3/documents/bulk",{body:t,...r})}get(t,r){return this._client.get((0,et.path)`/v3/documents/${t}`,r)}listProcessing(t){return this._client.get("/v3/documents/processing",t)}uploadFile(t,r){return this._client.post("/v3/documents/file",(0,Tn.multipartFormRequestOptions)({body:t,...r},this._client))}};Ee.Documents=tt});var st=d(Pe=>{"use strict";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.Memories=void 0;var $n=k(),Fn=z(),qn=J(),nt=Se(),ot=class extends $n.APIResource{update(t,r={},n){return this._client.patch((0,nt.path)`/v3/documents/${t}`,{body:r,...n})}list(t={},r){return this._client.post("/v3/documents/list",{body:t,...r})}delete(t,r){return this._client.delete((0,nt.path)`/v3/documents/${t}`,{...r,headers:(0,Fn.buildHeaders)([{Accept:"*/*"},r?.headers])})}add(t,r){return this._client.post("/v3/documents",{body:t,...r})}forget(t,r){return this._client.delete("/v4/memories",{body:t,...r})}get(t,r){return this._client.get((0,nt.path)`/v3/documents/${t}`,r)}updateMemory(t,r){return this._client.patch("/v4/memories",{body:t,...r})}uploadFile(t,r){return this._client.post("/v3/documents/file",(0,qn.multipartFormRequestOptions)({body:t,...r},this._client))}};Pe.Memories=ot});var at=d(Re=>{"use strict";Object.defineProperty(Re,"__esModule",{value:!0});Re.Search=void 0;var xn=k(),it=class extends xn.APIResource{documents(t,r){return this._client.post("/v3/search",{body:t,...r})}execute(t,r){return this._client.post("/v3/search",{body:t,...r})}memories(t,r){return this._client.post("/v4/search",{body:t,...r})}};Re.Search=it});var ut=d(Oe=>{"use strict";Object.defineProperty(Oe,"__esModule",{value:!0});Oe.Settings=void 0;var Mn=k(),ct=class extends Mn.APIResource{update(t={},r){return this._client.patch("/v3/settings",{body:t,...r})}get(t){return this._client.get("/v3/settings",t)}};Oe.Settings=ct});var Wt=d(O=>{"use strict";Object.defineProperty(O,"__esModule",{value:!0});O.Settings=O.Search=O.Memories=O.Documents=O.Connections=void 0;var jn=Ze();Object.defineProperty(O,"Connections",{enumerable:!0,get:function(){return jn.Connections}});var Un=rt();Object.defineProperty(O,"Documents",{enumerable:!0,get:function(){return Un.Documents}});var kn=st();Object.defineProperty(O,"Memories",{enumerable:!0,get:function(){return kn.Memories}});var Cn=at();Object.defineProperty(O,"Search",{enumerable:!0,get:function(){return Cn.Search}});var Ln=ut();Object.defineProperty(O,"Settings",{enumerable:!0,get:function(){return Ln.Settings}})});var lt=d(M=>{"use strict";Object.defineProperty(M,"__esModule",{value:!0});M.formatRequestDetails=M.parseLogLevel=void 0;M.loggerFor=Qt;var Dn=Y(),ve={off:0,error:200,warn:300,info:400,debug:500},Nn=(e,t,r)=>{if(e){if((0,Dn.hasOwn)(ve,e))return e;Qt(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(ve))}`)}};M.parseLogLevel=Nn;function Q(){}function Ae(e,t,r){return!t||ve[e]>ve[r]?Q:t[e].bind(t)}var Bn={error:Q,warn:Q,info:Q,debug:Q},zt=new WeakMap;function Qt(e){let t=e.logger,r=e.logLevel??"off";if(!t)return Bn;let n=zt.get(t);if(n&&n[0]===r)return n[1];let o={error:Ae("error",t,r),warn:Ae("warn",t,r),info:Ae("info",t,r),debug:Ae("debug",t,r)};return zt.set(t,[r,o]),o}var Hn=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([t,r])=>[t,t.toLowerCase()==="authorization"||t.toLowerCase()==="cookie"||t.toLowerCase()==="set-cookie"?"***":r]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);M.formatRequestDetails=Hn});var er=d(dt=>{"use strict";Object.defineProperty(dt,"__esModule",{value:!0});dt.defaultParseResponse=Xn;var Zt=lt();async function Xn(e,t){let{response:r,requestLogID:n,retryOfRequestLogID:o,startTime:s}=t,i=await(async()=>{if(r.status===204)return null;if(t.options.__binaryResponse)return r;let h=r.headers.get("content-type")?.split(";")[0]?.trim();return h?.includes("application/json")||h?.endsWith("+json")?await r.json():await r.text()})();return(0,Zt.loggerFor)(e).debug(`[${n}] response parsed`,(0,Zt.formatRequestDetails)({retryOfRequestLogID:o,url:r.url,status:r.status,body:i,durationMs:Date.now()-s})),i}});var mt=d(Ie=>{"use strict";var Z;Object.defineProperty(Ie,"__esModule",{value:!0});Ie.APIPromise=void 0;var pt=Ce(),Kn=er(),ft=class e extends Promise{constructor(t,r,n=Kn.defaultParseResponse){super(o=>{o(null)}),this.responsePromise=r,this.parseResponse=n,Z.set(this,void 0),pt.__classPrivateFieldSet(this,Z,t,"f")}_thenUnwrap(t){return new e(pt.__classPrivateFieldGet(this,Z,"f"),this.responsePromise,async(r,n)=>t(await this.parseResponse(r,n),n))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){let[t,r]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:r}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(t=>this.parseResponse(pt.__classPrivateFieldGet(this,Z,"f"),t))),this.parsedPromise}then(t,r){return this.parse().then(t,r)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}};Ie.APIPromise=ft;Z=new WeakMap});var tr=d(Te=>{"use strict";Object.defineProperty(Te,"__esModule",{value:!0});Te.readEnv=void 0;var Vn=e=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[e]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(e)?.trim()};Te.readEnv=Vn});var Et=d(Fe=>{"use strict";var St,wt,$e,rr;Object.defineProperty(Fe,"__esModule",{value:!0});Fe.Supermemory=void 0;var q=Ce(),Yn=Mt(),ht=Y(),Gn=jt(),yt=Le(),Jn=Lt(),gt=q.__importStar(He()),Wn=q.__importStar(Nt()),zn=Be(),b=q.__importStar(K()),Qn=q.__importStar(Je()),ee=q.__importStar(Wt()),Zn=mt(),eo=Ze(),to=rt(),ro=st(),no=at(),oo=ut(),bt=z(),_t=tr(),S=lt(),so=Y(),f=class{constructor({baseURL:t=(0,_t.readEnv)("SUPERMEMORY_BASE_URL"),apiKey:r=(0,_t.readEnv)("SUPERMEMORY_API_KEY"),...n}={}){if(St.add(this),$e.set(this,void 0),this.memories=new ee.Memories(this),this.documents=new ee.Documents(this),this.search=new ee.Search(this),this.settings=new ee.Settings(this),this.connections=new ee.Connections(this),r===void 0)throw new b.SupermemoryError("The SUPERMEMORY_API_KEY environment variable is missing or empty; either provide it, or instantiate the Supermemory client with an apiKey option, like new Supermemory({ apiKey: 'My API Key' }).");let o={apiKey:r,...n,baseURL:t||"https://api.supermemory.ai"};this.baseURL=o.baseURL,this.timeout=o.timeout??wt.DEFAULT_TIMEOUT,this.logger=o.logger??console;let s="warn";this.logLevel=s,this.logLevel=(0,S.parseLogLevel)(o.logLevel,"ClientOptions.logLevel",this)??(0,S.parseLogLevel)((0,_t.readEnv)("SUPERMEMORY_LOG"),"process.env['SUPERMEMORY_LOG']",this)??s,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??gt.getDefaultFetch(),q.__classPrivateFieldSet(this,$e,Wn.FallbackEncoder,"f"),this._options=o,this.apiKey=r}withOptions(t){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,...t})}add(t,r){return this.post("/v3/documents",{body:t,...r})}profile(t,r){return this.post("/v4/profile",{body:t,...r})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:t,nulls:r}){}async authHeaders(t){return(0,bt.buildHeaders)([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(t){return Object.entries(t).filter(([r,n])=>typeof n<"u").map(([r,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(r)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(r)}=`;throw new b.SupermemoryError(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${zn.VERSION}`}defaultIdempotencyKey(){return`stainless-node-retry-${(0,Yn.uuid4)()}`}makeStatusError(t,r,n,o){return b.APIError.generate(t,r,n,o)}buildURL(t,r,n){let o=!q.__classPrivateFieldGet(this,St,"m",rr).call(this)&&n||this.baseURL,s=(0,ht.isAbsoluteURL)(t)?new URL(t):new URL(o+(o.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),i=this.defaultQuery();return(0,so.isEmptyObj)(i)||(r={...i,...r}),typeof r=="object"&&r&&!Array.isArray(r)&&(s.search=this.stringifyQuery(r)),s.toString()}async prepareOptions(t){}async prepareRequest(t,{url:r,options:n}){}get(t,r){return this.methodRequest("get",t,r)}post(t,r){return this.methodRequest("post",t,r)}patch(t,r){return this.methodRequest("patch",t,r)}put(t,r){return this.methodRequest("put",t,r)}delete(t,r){return this.methodRequest("delete",t,r)}methodRequest(t,r,n){return this.request(Promise.resolve(n).then(o=>({method:t,path:r,...o})))}request(t,r=null){return new Zn.APIPromise(this,this.makeRequest(t,r,void 0))}async makeRequest(t,r,n){let o=await t,s=o.maxRetries??this.maxRetries;r==null&&(r=s),await this.prepareOptions(o);let{req:i,url:a,timeout:h}=await this.buildRequest(o,{retryCount:s-r});await this.prepareRequest(i,{url:a,options:o});let m="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),y=n===void 0?"":`, retryOf: ${n}`,g=Date.now();if((0,S.loggerFor)(this).debug(`[${m}] sending request`,(0,S.formatRequestDetails)({retryOfRequestLogID:n,method:o.method,url:a,options:o,headers:i.headers})),o.signal?.aborted)throw new b.APIUserAbortError;let w=new AbortController,c=await this.fetchWithTimeout(a,i,h,w).catch(yt.castToError),E=Date.now();if(c instanceof globalThis.Error){let N=`retrying, ${r} attempts remaining`;if(o.signal?.aborted)throw new b.APIUserAbortError;let $=(0,yt.isAbortError)(c)||/timed? ?out/i.test(String(c)+("cause"in c?String(c.cause):""));if(r)return(0,S.loggerFor)(this).info(`[${m}] connection ${$?"timed out":"failed"} - ${N}`),(0,S.loggerFor)(this).debug(`[${m}] connection ${$?"timed out":"failed"} (${N})`,(0,S.formatRequestDetails)({retryOfRequestLogID:n,url:a,durationMs:E-g,message:c.message})),this.retryRequest(o,r,n??m);throw(0,S.loggerFor)(this).info(`[${m}] connection ${$?"timed out":"failed"} - error; no more retries left`),(0,S.loggerFor)(this).debug(`[${m}] connection ${$?"timed out":"failed"} (error; no more retries left)`,(0,S.formatRequestDetails)({retryOfRequestLogID:n,url:a,durationMs:E-g,message:c.message})),$?new b.APIConnectionTimeoutError:new b.APIConnectionError({cause:c})}let D=`[${m}${y}] ${i.method} ${a} ${c.ok?"succeeded":"failed"} with status ${c.status} in ${E-g}ms`;if(!c.ok){let N=await this.shouldRetry(c);if(r&&N){let oe=`retrying, ${r} attempts remaining`;return await gt.CancelReadableStream(c.body),(0,S.loggerFor)(this).info(`${D} - ${oe}`),(0,S.loggerFor)(this).debug(`[${m}] response error (${oe})`,(0,S.formatRequestDetails)({retryOfRequestLogID:n,url:c.url,status:c.status,headers:c.headers,durationMs:E-g})),this.retryRequest(o,r,n??m,c.headers)}let $=N?"error; no more retries left":"error; not retryable";(0,S.loggerFor)(this).info(`${D} - ${$}`);let $t=await c.text().catch(oe=>(0,yt.castToError)(oe).message),Ft=(0,ht.safeJSON)($t),qt=Ft?void 0:$t;throw(0,S.loggerFor)(this).debug(`[${m}] response error (${$})`,(0,S.formatRequestDetails)({retryOfRequestLogID:n,url:c.url,status:c.status,headers:c.headers,message:qt,durationMs:Date.now()-g})),this.makeStatusError(c.status,Ft,qt,c.headers)}return(0,S.loggerFor)(this).info(D),(0,S.loggerFor)(this).debug(`[${m}] response start`,(0,S.formatRequestDetails)({retryOfRequestLogID:n,url:c.url,status:c.status,headers:c.headers,durationMs:E-g})),{response:c,options:o,controller:w,requestLogID:m,retryOfRequestLogID:n,startTime:g}}async fetchWithTimeout(t,r,n,o){let{signal:s,method:i,...a}=r||{};s&&s.addEventListener("abort",()=>o.abort());let h=setTimeout(()=>o.abort(),n),m=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||typeof a.body=="object"&&a.body!==null&&Symbol.asyncIterator in a.body,y={signal:o.signal,...m?{duplex:"half"}:{},method:"GET",...a};i&&(y.method=i.toUpperCase());try{return await this.fetch.call(void 0,t,y)}finally{clearTimeout(h)}}async shouldRetry(t){let r=t.headers.get("x-should-retry");return r==="true"?!0:r==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,r,n,o){let s,i=o?.get("retry-after-ms");if(i){let h=parseFloat(i);Number.isNaN(h)||(s=h)}let a=o?.get("retry-after");if(a&&!s){let h=parseFloat(a);Number.isNaN(h)?s=Date.parse(a)-Date.now():s=h*1e3}if(!(s&&0<=s&&s<60*1e3)){let h=t.maxRetries??this.maxRetries;s=this.calculateDefaultRetryTimeoutMillis(r,h)}return await(0,Gn.sleep)(s),this.makeRequest(t,r-1,n)}calculateDefaultRetryTimeoutMillis(t,r){let s=r-t,i=Math.min(.5*Math.pow(2,s),8),a=1-Math.random()*.25;return i*a*1e3}async buildRequest(t,{retryCount:r=0}={}){let n={...t},{method:o,path:s,query:i,defaultBaseURL:a}=n,h=this.buildURL(s,i,a);"timeout"in n&&(0,ht.validatePositiveInteger)("timeout",n.timeout),n.timeout=n.timeout??this.timeout;let{bodyHeaders:m,body:y}=this.buildBody({options:n}),g=await this.buildHeaders({options:t,method:o,bodyHeaders:m,retryCount:r});return{req:{method:o,headers:g,...n.signal&&{signal:n.signal},...globalThis.ReadableStream&&y instanceof globalThis.ReadableStream&&{duplex:"half"},...y&&{body:y},...this.fetchOptions??{},...n.fetchOptions??{}},url:h,timeout:n.timeout}}async buildHeaders({options:t,method:r,bodyHeaders:n,retryCount:o}){let s={};this.idempotencyHeader&&r!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=t.idempotencyKey);let i=(0,bt.buildHeaders)([s,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(o),...t.timeout?{"X-Stainless-Timeout":String(Math.trunc(t.timeout/1e3))}:{},...(0,Jn.getPlatformHeaders)()},await this.authHeaders(t),this._options.defaultHeaders,n,t.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:t,headers:r}}){if(!t)return{bodyHeaders:void 0,body:void 0};let n=(0,bt.buildHeaders)([r]);return ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof DataView||typeof t=="string"&&n.values.has("content-type")||globalThis.Blob&&t instanceof globalThis.Blob||t instanceof FormData||t instanceof URLSearchParams||globalThis.ReadableStream&&t instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:t}:typeof t=="object"&&(Symbol.asyncIterator in t||Symbol.iterator in t&&"next"in t&&typeof t.next=="function")?{bodyHeaders:void 0,body:gt.ReadableStreamFrom(t)}:q.__classPrivateFieldGet(this,$e,"f").call(this,{body:t,headers:n})}};Fe.Supermemory=f;wt=f,$e=new WeakMap,St=new WeakSet,rr=function(){return this.baseURL!=="https://api.supermemory.ai"};f.Supermemory=wt;f.DEFAULT_TIMEOUT=6e4;f.SupermemoryError=b.SupermemoryError;f.APIError=b.APIError;f.APIConnectionError=b.APIConnectionError;f.APIConnectionTimeoutError=b.APIConnectionTimeoutError;f.APIUserAbortError=b.APIUserAbortError;f.NotFoundError=b.NotFoundError;f.ConflictError=b.ConflictError;f.RateLimitError=b.RateLimitError;f.BadRequestError=b.BadRequestError;f.AuthenticationError=b.AuthenticationError;f.InternalServerError=b.InternalServerError;f.PermissionDeniedError=b.PermissionDeniedError;f.UnprocessableEntityError=b.UnprocessableEntityError;f.toFile=Qn.toFile;f.Memories=ro.Memories;f.Documents=to.Documents;f.Search=no.Search;f.Settings=oo.Settings;f.Connections=eo.Connections});var or=d((u,nr)=>{"use strict";u=nr.exports=function(...e){return new u.default(...e)};Object.defineProperty(u,"__esModule",{value:!0});u.UnprocessableEntityError=u.PermissionDeniedError=u.InternalServerError=u.AuthenticationError=u.BadRequestError=u.RateLimitError=u.ConflictError=u.NotFoundError=u.APIUserAbortError=u.APIConnectionTimeoutError=u.APIConnectionError=u.APIError=u.SupermemoryError=u.Supermemory=u.APIPromise=u.toFile=u.default=void 0;var io=Et();Object.defineProperty(u,"default",{enumerable:!0,get:function(){return io.Supermemory}});var ao=Je();Object.defineProperty(u,"toFile",{enumerable:!0,get:function(){return ao.toFile}});var co=mt();Object.defineProperty(u,"APIPromise",{enumerable:!0,get:function(){return co.APIPromise}});var uo=Et();Object.defineProperty(u,"Supermemory",{enumerable:!0,get:function(){return uo.Supermemory}});var R=K();Object.defineProperty(u,"SupermemoryError",{enumerable:!0,get:function(){return R.SupermemoryError}});Object.defineProperty(u,"APIError",{enumerable:!0,get:function(){return R.APIError}});Object.defineProperty(u,"APIConnectionError",{enumerable:!0,get:function(){return R.APIConnectionError}});Object.defineProperty(u,"APIConnectionTimeoutError",{enumerable:!0,get:function(){return R.APIConnectionTimeoutError}});Object.defineProperty(u,"APIUserAbortError",{enumerable:!0,get:function(){return R.APIUserAbortError}});Object.defineProperty(u,"NotFoundError",{enumerable:!0,get:function(){return R.NotFoundError}});Object.defineProperty(u,"ConflictError",{enumerable:!0,get:function(){return R.ConflictError}});Object.defineProperty(u,"RateLimitError",{enumerable:!0,get:function(){return R.RateLimitError}});Object.defineProperty(u,"BadRequestError",{enumerable:!0,get:function(){return R.BadRequestError}});Object.defineProperty(u,"AuthenticationError",{enumerable:!0,get:function(){return R.AuthenticationError}});Object.defineProperty(u,"InternalServerError",{enumerable:!0,get:function(){return R.InternalServerError}});Object.defineProperty(u,"PermissionDeniedError",{enumerable:!0,get:function(){return R.PermissionDeniedError}});Object.defineProperty(u,"UnprocessableEntityError",{enumerable:!0,get:function(){return R.UnprocessableEntityError}})});var ir=d((Ts,sr)=>{var lo=or().default,po="sm_project_default",fo=process.env.SUPERMEMORY_API_URL||"https://api.supermemory.ai",Pt=class{constructor(t,r){if(!t)throw new Error("SUPERMEMORY_API_KEY is required");this.client=new lo({apiKey:t,baseURL:fo}),this.containerTag=r||po}async addMemory(t,r,n={},o=null){let s={content:t,containerTag:r||this.containerTag,metadata:{sm_source:"claude-code-plugin",...n}};o&&(s.customId=o);let i=await this.client.add(s);return{id:i.id,status:i.status,containerTag:r||this.containerTag}}async search(t,r,n={}){let o=await this.client.search.memories({q:t,containerTag:r||this.containerTag,limit:n.limit||10,searchMode:n.searchMode||"hybrid"});return{results:o.results.map(s=>({id:s.id,memory:s.content||s.memory||s.context||"",similarity:s.similarity,title:s.title,content:s.content})),total:o.total,timing:o.timing}}async getProfile(t,r){let n=await this.client.profile({containerTag:t||this.containerTag,q:r});return{profile:{static:n.profile?.static||[],dynamic:n.profile?.dynamic||[]},searchResults:n.searchResults?{results:n.searchResults.results.map(o=>({id:o.id,memory:o.content||o.context||"",similarity:o.similarity,title:o.title})),total:n.searchResults.total,timing:n.searchResults.timing}:void 0}}async listMemories(t,r=20){let n=await this.client.memories.list({containerTags:t||this.containerTag,limit:r,order:"desc",sort:"createdAt"});return{memories:n.memories||n.results||[]}}async deleteMemory(t){return this.client.memories.delete(t)}};sr.exports={SupermemoryClient:Pt}});var ur=d(($s,cr)=>{var{execSync:ar}=require("child_process"),mo=require("crypto");function qe(e){return mo.createHash("sha256").update(e).digest("hex").slice(0,16)}function Rt(e){try{return ar("git rev-parse --show-toplevel",{cwd:e,encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim()||null}catch{return null}}function ho(e){let r=Rt(e)||e;return`claudecode_project_${qe(r)}`}function yo(e){return(Rt(e)||e).split("/").pop()||"unknown"}function go(){try{let t=ar("git config user.email",{encoding:"utf-8",stdio:["pipe","pipe","pipe"]}).trim();if(t)return`claudecode_user_${qe(t)}`}catch{}let e=process.env.USER||process.env.USERNAME||"anonymous";return`claudecode_user_${qe(e)}`}cr.exports={sha256:qe,getGitRoot:Rt,getContainerTag:ho,getProjectName:yo,getUserContainerTag:go}});var dr=d((Fs,lr)=>{var Ot=/<private>[\s\S]*?<\/private>/gi;function vt(e){if(!e||typeof e!="string")return e;let t=e.match(Ot);return t&&t.length>100&&console.error(`Privacy: Too many tags (${t.length}), truncating`),e.replace(Ot,"[PRIVATE]")}function bo(e){if(!e||typeof e!="string")return!0;let t=vt(e).trim();return t==="[PRIVATE]"||t===""||t==="[PRIVATE][PRIVATE]"}function _o(e){return!e||typeof e!="string"?!1:Ot.test(e)}function At(e){if(e==null)return e;if(typeof e=="string")return vt(e);if(Array.isArray(e))return e.map(t=>At(t));if(typeof e=="object"){let t={};for(let[r,n]of Object.entries(e))t[r]=At(n);return t}return e}lr.exports={stripPrivateContent:vt,isFullyPrivate:bo,containsPrivateTag:_o,stripPrivateFromJson:At}});var fr=d((qs,pr)=>{function T(e){return e?e.split("/").slice(-2).join("/"):"unknown"}function A(e,t=50){return e?e.length<=t?e:e.slice(0,t)+"...":""}function So(e,t,r){let n=t||{},o=r||{};switch(e){case"Edit":{let s=T(n.file_path),i=A(n.old_string,30),a=A(n.new_string,30);return n.replace_all?`Replaced all "${i}" with "${a}" in ${s}`:`Edited ${s}: "${i}" \u2192 "${a}"`}case"Write":{let s=T(n.file_path),i=(n.content||"").length;return`Created ${s} (${i} chars)`}case"Bash":{let s=A(n.command,80),i=!o.error&&o.exitCode!==1,a=n.description?` - ${A(n.description,40)}`:"";return`Ran: ${s}${a}${i?"":" [FAILED]"}`}case"Task":{let s=n.description||A(n.prompt,60)||"subtask";return`Spawned ${n.subagent_type||"agent"}: ${s}`}case"Read":{let s=T(n.file_path),i=n.limit?` (${n.limit} lines)`:"";return`Read ${s}${i}`}case"Glob":{let s=n.pattern||"*",i=n.path?` in ${T(n.path)}`:"";return`Glob: ${s}${i}`}case"Grep":{let s=A(n.pattern,40),i=n.path?` in ${T(n.path)}`:"";return`Grep: "${s}"${i}`}case"WebFetch":return`Fetched: ${A(n.url,60)}`;case"WebSearch":return`Searched web: "${A(n.query,60)}"`;case"NotebookEdit":{let s=T(n.notebook_path);return`${n.edit_mode||"edit"} notebook cell in ${s}`}default:return`Used ${e}`}}function wo(e,t){let r=t||{},n={tool:e};return r.file_path&&(n.file=T(r.file_path)),r.notebook_path&&(n.file=T(r.notebook_path)),e==="Bash"&&r.command&&(n.command=A(r.command,100)),r.pattern&&(n.pattern=A(r.pattern,50)),n}pr.exports={compressObservation:So,getObservationMetadata:wo,getRelativePath:T,truncate:A}});var gr=d((xs,yr)=>{var Eo=require("http"),j=require("fs"),mr=require("path"),Po=require("os"),{exec:Ro}=require("child_process"),Tt=mr.join(Po.homedir(),".supermemory-claude"),L=mr.join(Tt,"credentials.json"),Oo=process.env.SUPERMEMORY_AUTH_URL||"https://console.supermemory.ai/auth/connect",It=19876,Ao=25e3;function vo(){j.existsSync(Tt)||j.mkdirSync(Tt,{recursive:!0})}function Io(){try{if(j.existsSync(L)){let e=JSON.parse(j.readFileSync(L,"utf-8"));if(e.apiKey)return e}}catch{}return null}function hr(e){vo();let t={apiKey:e,savedAt:new Date().toISOString()};j.writeFileSync(L,JSON.stringify(t,null,2))}function To(){try{j.existsSync(L)&&j.unlinkSync(L)}catch{}}function $o(e){let t=process.platform==="darwin"?"open":process.platform==="win32"?"start":"xdg-open";Ro(`${t} "${e}"`)}function Fo(){return new Promise((e,t)=>{let r=!1,n=Eo.createServer((o,s)=>{let i=new URL(o.url,`http://localhost:${It}`);if(i.pathname==="/callback"){let a=i.searchParams.get("apikey")||i.searchParams.get("api_key");a&&a.startsWith("sm_")?(hr(a),s.writeHead(200,{"Content-Type":"text/html"}),s.end(`<!DOCTYPE html>
<html>
<head><title>Connected - Supermemory</title><style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;background:#faf9f6}
.status-box{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border:1px solid #e5e0db;border-radius:50px;margin-bottom:32px}
.dot{width:8px;height:8px;background:#c75d38;border-radius:50%}
.status-text{font-size:14px;color:#c75d38;letter-spacing:0.5px}
h1{font-size:36px;font-weight:500;color:#1a1a1a;margin:0 0 16px;letter-spacing:-0.5px}
h1 span{color:#c75d38}
p{color:#666;font-size:16px;margin:0}
</style></head>
<body>
<div class="status-box"><span class="dot"></span><span class="status-text">Connected . . .</span></div>
<h1>Claude Code <span>\xD7</span> Supermemory</h1>
<p>You can close this window and return to your terminal.</p>
</body>
</html>`),r=!0,n.close(),e(a)):(s.writeHead(400,{"Content-Type":"text/html"}),s.end(`<!DOCTYPE html>
<html>
<head><title>Error - Supermemory</title><style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;background:#faf9f6}
.status-box{display:inline-flex;align-items:center;gap:8px;padding:8px 16px;border:1px solid #e5e0db;border-radius:50px;margin-bottom:32px}
.dot{width:8px;height:8px;background:#ef4444;border-radius:50%}
.status-text{font-size:14px;color:#ef4444;letter-spacing:0.5px}
h1{font-size:36px;font-weight:500;color:#1a1a1a;margin:0 0 16px;letter-spacing:-0.5px}
p{color:#666;font-size:16px;margin:0}
</style></head>
<body>
<div class="status-box"><span class="dot"></span><span class="status-text">Error . . .</span></div>
<h1>Connection Failed</h1>
<p>Invalid API key received. Please try again.</p>
</body>
</html>`))}else s.writeHead(404),s.end("Not found")});n.listen(It,"127.0.0.1",()=>{let o=`http://localhost:${It}/callback`,s=`${Oo}?callback=${encodeURIComponent(o)}&client=claude_code`;$o(s)}),n.on("error",o=>{r||t(new Error(`Failed to start auth server: ${o.message}`))}),setTimeout(()=>{r||(n.close(),t(new Error("AUTH_TIMEOUT")))},Ao)})}yr.exports={CREDENTIALS_FILE:L,loadCredentials:Io,saveCredentials:hr,clearCredentials:To,startAuthFlow:Fo}});var wr=d((Ms,Sr)=>{var re=require("fs"),br=require("path"),qo=require("os"),{loadCredentials:xo}=gr(),xe=br.join(qo.homedir(),".supermemory-claude"),te=br.join(xe,"settings.json"),_r={skipTools:["Read","Glob","Grep","TodoWrite","AskUserQuestion"],captureTools:["Edit","Write","Bash","Task"],maxContextMemories:10,maxProjectMemories:20,maxProfileItems:5,debug:!1,injectProfile:!0};function Mo(){re.existsSync(xe)||re.mkdirSync(xe,{recursive:!0})}function jo(){let e={..._r};try{if(re.existsSync(te)){let t=re.readFileSync(te,"utf-8");Object.assign(e,JSON.parse(t))}}catch(t){console.error(`Settings: Failed to load ${te}: ${t.message}`)}return process.env.SUPERMEMORY_API_KEY&&(e.apiKey=process.env.SUPERMEMORY_API_KEY),process.env.SUPERMEMORY_SKIP_TOOLS&&(e.skipTools=process.env.SUPERMEMORY_SKIP_TOOLS.split(",").map(t=>t.trim())),process.env.SUPERMEMORY_DEBUG==="true"&&(e.debug=!0),e}function Uo(e){Mo();let t={...e};delete t.apiKey,re.writeFileSync(te,JSON.stringify(t,null,2))}function ko(e){if(e.apiKey)return e.apiKey;if(process.env.SUPERMEMORY_API_KEY)return process.env.SUPERMEMORY_API_KEY;let t=xo();if(t?.apiKey)return t.apiKey;throw new Error("NO_API_KEY")}function Co(e,t){return t.skipTools.includes(e)?!1:t.captureTools&&t.captureTools.length>0?t.captureTools.includes(e):!0}function Lo(e,t,r){if(e.debug){let n=new Date().toISOString();console.error(r?`[${n}] ${t}: ${JSON.stringify(r)}`:`[${n}] ${t}`)}}Sr.exports={SETTINGS_DIR:xe,SETTINGS_FILE:te,DEFAULT_SETTINGS:_r,loadSettings:jo,saveSettings:Uo,getApiKey:ko,shouldCaptureTool:Co,debugLog:Lo}});var Pr=d((js,Er)=>{async function Do(){return new Promise((e,t)=>{let r="";process.stdin.setEncoding("utf8"),process.stdin.on("data",n=>{r+=n}),process.stdin.on("end",()=>{try{e(r.trim()?JSON.parse(r):{})}catch(n){t(new Error(`Failed to parse stdin JSON: ${n.message}`))}}),process.stdin.on("error",t),process.stdin.isTTY&&e({})})}function Me(e){console.log(JSON.stringify(e))}function No(e=null){Me(e?{hookSpecificOutput:{hookEventName:"SessionStart",additionalContext:e}}:{continue:!0,suppressOutput:!0})}function Bo(e){console.error(`Supermemory: ${e}`),Me({continue:!0,suppressOutput:!0})}Er.exports={readStdin:Do,writeOutput:Me,outputSuccess:No,outputError:Bo}});var{SupermemoryClient:Ho}=ir(),{getContainerTag:Xo,getProjectName:Ko}=ur(),{stripPrivateFromJson:Rr}=dr(),{compressObservation:Vo,getObservationMetadata:Yo}=fr(),{loadSettings:Go,getApiKey:Jo,shouldCaptureTool:Wo,debugLog:ne}=wr(),{readStdin:zo,outputSuccess:je,outputError:Qo}=Pr();async function Zo(){let e=Go();try{let t=await zo(),r=t.cwd||process.cwd(),n=t.session_id,o=t.tool_name,s=t.tool_input,i=t.tool_response;if(ne(e,"PostToolUse",{sessionId:n,toolName:o}),!Wo(o,e)){ne(e,"Skipping tool",{toolName:o}),je();return}let a;try{a=Jo(e)}catch{je();return}let h=Rr(s),m=Rr(i),y=Vo(o,h,m);if(!y){ne(e,"No compression result"),je();return}let g=new Ho(a),w=Xo(r),c=Ko(r),E={...Yo(o,h),type:"observation",project:c,timestamp:new Date().toISOString()};await g.addMemory(`[${o.toUpperCase()}] ${y}`,w,E,n),ne(e,"Observation saved",{compressed:y}),je()}catch(t){ne(e,"Error",{error:t.message}),Qo(t.message)}}Zo().catch(e=>{console.error(`Supermemory fatal: ${e.message}`),process.exit(1)});
